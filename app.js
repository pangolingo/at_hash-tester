const oidcTokenHash = require('oidc-token-hash');
const jwt = require('jsonwebtoken');

const tokenResponse = {
  access_token:
   'eyJhbGciOiJSU0EtT0FFUC0yNTYiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiazZtXzFmOHMzMEN0UkJYVEI5OU5QdTUzSVh2bDdFT0JPT0xMZ1dwc05ySSIsImN0eSI6IkpXVCJ9.Q_jCEBNz4m45j1ZtR4vGqzCeStCrExHZsoOQwQ7MR-Z6vn9zOwhdZ5m6q2cUxyZ6mX-ldKYl6wff_s4nksKQilX-EEOYqaE2Qo3oPEVUAdp4gIobqZoxf2oCCo0mh3CqzElHzK9WgVwDWojSGrZPOzy2FiAotI8SH2t0nlwtVfwPsv3xo25RO1nRKqJRg0lU23UhggBjvjEc-MY3H4i5uN2DFlyM2oTTl9E8xnx1ZLsSo7SGaopvPh7l8grVcz-G971vkRFYTiw9XW9GibO7-_fyjGancVYNgui2CpmHcdVmDGQlIiOjGYTh8VwR5sIwCLz3jdSfCZYg34vLStIpeg.v2c8csLDyDziqcrcact1Fw.3FMw-okgRfjao9NlyqTnxbAPqQUdYCuIIt290cguZ7R4OUI6k1z0YfKi2zdPK3RN7G42jxtcn1asB3Obp3ocTEnNOVAu6ATHJ3SNg1Rl6dkiKyzJFUnziWTrEL4WRuhV253uBDh8eGoUAiX6y07OVVU7koBJgBCfPzcNhBpZmg6r2DXpoovvjEKXLo4Ozsn2fJ7wVhmKQQixZUfSkGq-atudoX4NUArLmCT5clCZexaPiv_eCyiUcsazXVBF9kZ7LjmxSjnYJNdZOCX6lKmEqFYlC31-XynOuSc8rbPUw-UaW-y5ZAy4k10Yp433unoLtmE8SSVJY1b8HlU6a5juOYKrZ-2W_4ifSm8RCCvkx-aHsEjBDUuDsrSvWjcCapoMK6n9ttuEvrtp51yGIAYNIHTCo_eMZMf2TFxCRVBMr_3RBHeghSngpv4CWNnkDtrg2ltTvA54SyZNvooMW99OFOHhOgwOTfXGfZWRu0NaFnVYtq6SG2QQSuomk-j-sFGw-SDELs6t_z1FtvT9xA5GkW7JETihcikgfwbeCfOe78Zt5kOmmoVp12ERQupzjHjEuvi1ykgvAXHX30ij4mGEpH43TnlBDwLBCI7ZkD4lmBOqQ7HMfy4Rz2p-eEM03UD1sGGNvumV9Noj-Cmkr492_pIANbuNAPjcdw010gzSHO3lt0hAK72GjiWgdfuX1wHgl4v2ncVJSMnQnBUBT7jDOwbXvhsGrlFWgZyAAyLbOFn_Qeuo4JJEOcj7zkbxo7J5zg4EaFvXCSKWuTSYI-1FSNAg1TjYU4BzGe6v-EYRpg_342vMaXqIuSWSLK5WQNWeYf-lA90sdLgANvb-7nTRruwMs8FKAFlUikALNI-JHuPTf21HL9dkS_LQfAMTRLYxpT-QR6eQ9Jtp6orIlV_RRVJylQiIO7SwlQrxItZFjzgXBexzG731cRUyavTzLdxI3mtSYpyqNwFljE-w6VO67LFIpmJQS4FC4doksGh7AHlhIWaH4EKOPGRKku3UHWjwUhBdr2x9zddMAgDKT7P1eghiwjnpzV3Apnaa-_NWs_v8STcHlLlua4hkNUXTEH7Psy4XCeOgKoxHR7RS6Qh83NT95eb9L9Bk0VMCCPjur-TD5u4-YW_vn7bIZz17wvBWiOD5BQbENeL4FS5mpxRqwAmmuvFkp9l7VzpcKI7COESTePCUS-vpUk-QpDVXK9kN31_yOF_KX4RUuLEXbCsLL9YGx0o1aqT1J-R5e_1BwOVN5ckOzfeY7DtavovguNNXPIYvBpj_SQu5Mnyt3BYxtpl4MZLSrc6-vzJLpc_mqzI1Rdns2WbUZWW8RcSUI5eHkrTkP-u-GwZwj_osx0ejcQoDJ35SZLypjOep7kJyXG8-KOYHkOGhXVPjY5jKxipgq4JMYTQlhLGI2BCM1G6vRLZmPngoNKRdTHD1-mzaQymi9AdYBVaekK54zaOzeThNS_MPS4-ShqMNpmAZtHEENMdqzfhGKwDBjiBdlCE4NI4qvaEEX_1S8651WccEfnmHqLBe5xfxn8aX2Y7dsVGiyBYSk6qkGQuULKHuUa78-TBU-n-e484Y9KNNLV3lusjRFiFO0DwijkpAiQD5yilvAuFYnwsuLhs9YXlO6-4qvtYRTBiO8p48cgwSMtywoAUL22w3JbUYhxXS7LoC7t676hCcuPity_S1XIPF_Glq-ZY.eTDE6l5QHtWxCUjvZaBDOw',
  scope: 'phone openid name postal_code email',
  id_token:
   'eyJraWQiOiJ0Sjd3R1FCcnQ2MWt0Z2V1dElHelVrVG40VkJjaDdPeW4xMFQ3bm95TnI0IiwiYWxnIjoiUlMyNTYifQ.eyJhdXRoX3RpbWUiOiIyMDIwMDIxODIxNDQ0OS5PWiIsIm5vbmNlIjoibnVsbCIsImFtciI6WyJtY2EiXSwiaWF0IjoxNTgyMDYzNjQ1LCJpc3MiOiJodHRwczovL29pZGMuaWRwLnhsb2dpbi5hdHQuY29tIiwic3ViIjoiMzEwMzgwLWN5R1NEd0VQTS1WUTlIY3lzTzUtWUVwV0xPUSIsImF0X2hhc2giOiI4a1piMDFfcFVYWVhQVXp1VEJ6aGh3IiwiY2FycmllclNka192ZXJzaW9uIjoidjEuMC4xIiwiZXhwIjozMTY0MTI5MDkwLCJhdWQiOiJjY2lkLTE0NmM4MDM0cTdldnZ5ZDMiLCJhY3IiOiJhMSJ9.A8_-oFWgdX5uj2Qu8V2XDJpJZtTU0FfB1mdHdL7sEY1or6pbm8JO6ZyJIScwFhihqjLX7l309rnfc0tZ1qDsm4BUMhyqvoQko_vTKQEi5T8xykeGjsTZJ-PQws41DEmoFPuHz40X352nJ-dQiKwuzWJjU9Aow8cYNbSINh2y6Ra17x_hodVHFaKPaQPrQnuVP5loifH60pH_pJdqBxx56zNF7LQ77iL0nBe7x4MPl_l1WpqitesgPHLbyJE6lIV72ijDOzL8yRWZTJtv_aIDZWpcUP2tGHRmFkf9rzrywx5wQ0SzGnA7TCTlumCG_hmJOQl9HvTLPJeCqMHZz407kg',
  token_type: 'bearer',
  expires_at: 1582065445 }

var idTokenJWT = jwt.decode(tokenResponse.id_token, {complete: true});
console.log(idTokenJWT);

// const at_hash = '6b7bcVd9TWZkrQkthkhONA';
// const at_hash = idTokenJWT.payload.at_hash;
// const accessToken = tokenResponse.access_token;
// const alg = idTokenJWT.header.alg;

const at_hash = 'id8eQdCi0jB4egVA0jbUDQ';
const accessToken = 'eyJhbGciOiJSU0EtT0FFUC0yNTYiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiazZtXzFmOHMzMEN0UkJYVEI5OU5QdTUzSVh2bDdFT0JPT0xMZ1dwc05ySSIsImN0eSI6IkpXVCJ9.qQ3-t-WVTb5jWPa5NOyg8RvtGYEBtJSn5WgeGjN7W98E7Zd0vGd6XDpgEPddPykWcH_ToZh12q9EqAKa_HJ_lGWHLIhbbG3HIalAgC_Tjrp792yk-jaOzIBDTHULXQY4JDWxut6UBgTj0gmryYSyCF3GE_QrKLCn-e9lADWk92o41CyCdOcjxP-ru3GKZUe6QUtpqVrP_0iOURkTAXt7tQdi5kF-kVMAJ0Nhj8EJ4q1xqzftMRw349YjGRLaZz6o_-jBl3irD0WlbUzYCHbqnh3pEdq09ICN36M5MwCrVlC6N8nK32sdEnfJa3YCTToVj5CC99HhAtFOns0YIBKCZQ.BM9qW0twKAprB_GdyfT2dQ.40DFqatFzTMlcxK8mUCoquR0_lC4C4K1rJdZGlGTnI-vExYEopBCLlnmgQUsLYDz_Lje08-pPml94L-0YLtBcIfUcCfHLafaKJPfOVhTmX48xb_h0sYVlmBFvGPj2mv2LojbGVBk6yl8OlMDcSoEViKOyPHvQK-M3PPKugZ8N9Y8ufs0gaUsmjidyBiqc5MKkjwntJFwSYUy4zjRqrvGPRfradb6cKpPGaUL9aYavSYgmks_QQ9pV1Nhjccg_U_YdMDEqRNrFD8PqyO6vHIQYZnvtrZ_5JGlnuG7AzyBeESY4Gxep0vNNAefzhDEB3LHL9JnUJZg1gIyxHUwfEOKVK6mJUXNW3objBRqbt_TgaXWZkyAsBYpRLLncm2kHbcPk3oDgAb1-shV8HdVR5uTBPabydwJpd9K-1M6hctDvN9nTjUXbtSQ3qDz4j1FUVSX0-mjHNGQuyWBqRn8tJGEDo553jQbAjOMVcmuecokZ3xSRm3igyHFOqyt3hzMz204xRKhoD2rxHRrl8nQ2zs9W5RDjJGOPGn66Xxx3SZJRwaUFoKtUnmIaA4UlTND_d-HQHoEMxo1s2f76eY3BQJrf2tYm5c5TJCie7gxWDh2w4U1hPFC6TQUcUG_-wo8nMZtbsVpbpdR7sqqekqJbabo6f22DfmuDz1ZoGid-Q74_deO65sc4sXrXo6nEkxb9fOL8-NeATlZCR7NOA1aDrPWv1FSBlyCG2XLi4du46Dayh0oIyGZjB2Kc10nnFWmGeeJUWH6duMoPeN6NvibAEpq24steD_aWyIUSicPsITFP7Sz1T6MaZB43tkb3EIB9P4VHcrNpSo53dRNdw8BrBdNhRE-EQaSEdqMnc6VcpJu8VgzOXNe1_RGiq2TH4ayEvv6hwhGDqxMA0eYe2Jv3EdrAjxh6c-P4rNTtWq4TUSfUQKRZLvtfj1WL-GjO2ZOF4Wk_BcJXhvNneVmYCrzuzVDJKe732Mk8FpApUB0_R9rEGdDZ0BPKt6voMRhzcjo4VRQJkJRt9E8GbdQBHJTzGWrR9E9lcKM05t2eXE3yCdaCxJVMP50TK3yI7HMNF1YbwrN2ABMiGg_2MLoLoFuCCuoLwXjEh3WCs5uVKJuyfJNZwbLplEe-AFl_BIT3OSvAFUfvcyZUpvWxLj4RxPtJURRHqcwUwsGvaFE8UMVQX6raDeUAn0X3X4MPz8jlQLmHthi9FRKf0XyRdqaQoJPr6A5tq6CN2rv4jPWImYAUawuM81XrrOnRs5cxAI7aYGqbjQ6RjoIVV_GkRRByS2hTQ6jBG0NzDN7JKLoHDIQ0liB-wGDQ_2EIFHhuw2OXKgffnV9QBFOsQpZ7NlFD-lGeWSnwfDG5aNhCAJsP5SqZmsq1vOq5U92isUp2oPm_XjPL146rWli612JDFnim3Xqqx6Lmd3hUXr0u-NCypbuCpHyePcNSTqDnOO_KpiSf-vXlL06BVEPB0XvFhoCozZSnbIG2Jk4Uz1UxJsKcVEIKFJWaI5pgm4D2iWuMItizA0tFGIIO1JPlrqnjIYjut2iVQeIb-xgvui3nA7IWUUGm-1kkQm5AFbyucUWfvinxKIGojwzjpNCKcyWG1IgECyXfwHngMY4nzqHNnmfTMRdE8pMscrVHMVBwRZjmg4Zw_nP8WsEHuh1VoQoH1vzjwmglKpauXrkW9xr63fffNX1_EJ55yA.dOYBMzr6LmOdyy1WI9mDww';
const alg = 'RS256';

oidcTokenHash.validate(
  { claim: 'at_hash', source: 'access_token' },
  at_hash, 
  accessToken,
  alg
);
console.log('Successfully validated');